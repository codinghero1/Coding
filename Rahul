<?php
session_start();
if(!isset($_SESSION['user_id'])){
  header("Location: login.php?redirect=checkout.php");
  exit;
}
?>
<!DOCTYPE html>
<html>
<head>
<title>Checkout</title>
<link rel="stylesheet" href="assets/checkout.css">
</head>
<body>

<div class="checkout">

<div class="step" id="billingStep">
  <h2>Billing Address</h2>
  <div id="billingAddressList"></div>
  <button onclick="openAddressForm('billing')">+ Add New</button>
  <button id="toShipping" disabled>Continue</button>
</div>

<div class="step" id="shippingStep">
  <h2>Shipping Address</h2>
  <div id="shippingAddressList"></div>
  <button onclick="openAddressForm('shipping')">+ Add New</button>
  <button id="toConfirm" disabled>Continue</button>
</div>

</div>

<!-- Address Modal -->
<div id="addressModal" class="modal">
  <div class="modal-content">
    <h3 id="addressTitle"></h3>
    <input id="full_name" placeholder="Full Name">
    <input id="mobile" placeholder="Mobile">
    <input id="line1" placeholder="Address Line 1">
    <input id="line2" placeholder="Address Line 2">
    <input id="city" placeholder="City">
    <input id="state" placeholder="State">
    <input id="pincode" placeholder="Pincode">
    <button onclick="saveAddress()">Save</button>
    <button onclick="closeAddress()">Cancel</button>
  </div>
</div>

<!-- Confirm Modal -->
<div id="confirmModal" class="modal">
  <div class="modal-content">
    <h3>Confirm Order</h3>
    <button onclick="placeOrder()">Place Order</button>
    <button onclick="closeConfirm()">Cancel</button>
  </div>
</div>

<script src="assets/checkout.js"></script>
</body>
</html>



body{font-family:Arial;background:#f2f2f2;}
.checkout{width:80%;margin:auto;padding:20px;}
.step{background:#fff;padding:20px;margin-bottom:20px;}
.address-card{
  border:1px solid #ccc;
  padding:10px;
  margin:10px 0;
  cursor:pointer;
}
.address-card:hover{background:#f9f9f9;}
.modal{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,.5);
  display:none;
  justify-content:center;
  align-items:center;
}
.modal-content{
  background:#fff;
  padding:20px;
  width:300px;
}
.modal input{
  width:100%;
  margin:5px 0;
  padding:8px;
}



let billing_id=0, shipping_id=0, currentType="billing";

function loadAddresses(type){
 fetch("ajax/get_addresses.php?type="+type)
 .then(r=>r.text())
 .then(d=>document.getElementById(type+"AddressList").innerHTML=d);
}
loadAddresses("billing"); loadAddresses("shipping");

function selectBilling(id){ billing_id=id; document.getElementById("toShipping").disabled=false; }
function selectShipping(id){ shipping_id=id; document.getElementById("toConfirm").disabled=false; }

document.getElementById("toShipping").onclick=()=>{ billingStep.style.display="none"; shippingStep.style.display="block"; }
document.getElementById("toConfirm").onclick=()=>{ confirmModal.style.display="flex"; }

function openAddressForm(type){
 currentType=type;
 addressTitle.innerText="Add "+type+" Address";
 addressModal.style.display="flex";
}
function closeAddress(){ addressModal.style.display="none"; }

function saveAddress(){
 let d=new URLSearchParams();
 d.append("type",currentType);
 d.append("full_name",full_name.value);
 d.append("mobile",mobile.value);
 d.append("line1",line1.value);
 d.append("line2",line2.value);
 d.append("city",city.value);
 d.append("state",state.value);
 d.append("pincode",pincode.value);

 fetch("ajax/add_address.php",{method:"POST",body:d})
 .then(()=>{ closeAddress(); loadAddresses(currentType); });
}

function placeOrder(){
 fetch("place_order.php",{method:"POST",
 headers:{"Content-Type":"application/x-www-form-urlencoded"},
 body:"billing_id="+billing_id+"&shipping_id="+shipping_id})
 .then(r=>r.text()).then(alert);
}
function closeConfirm(){ confirmModal.style.display="none"; }

<?php
session_start();
$conn=mysqli_connect("localhost","root","","ecom");
$type=$_GET['type'];

$q=mysqli_query($conn,"SELECT * FROM user_addresses WHERE user_id=".$_SESSION['user_id']." AND address_type='$type'");
while($r=mysqli_fetch_assoc($q)){
 echo "<div class='address-card' onclick='select".ucfirst($type)."(".$r['id'].")'>
 ".$r['full_name']."<br>".$r['address_line1'].", ".$r['city']."
 </div>";
}
